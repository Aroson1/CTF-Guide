# SQL Injection: Error-Based SQL Injection

## Introduction

Error-Based SQL Injection is a type of SQL injection attack where attackers exploit database error messages to gather information about the structure of the database. By intentionally causing errors, attackers can infer details such as table names, column names, and data types, which can then be used to craft more sophisticated SQL injection attacks.

## Table of Contents

- [SQL Injection: Error-Based SQL Injection](#sql-injection-error-based-sql-injection)
  - [Introduction](#introduction)
  - [Table of Contents](#table-of-contents)
  - [How to identify](#how-to-identify)
  - [Code/tools/websites](#codetoolswebsites)
    - [Code Snippets](#code-snippets)
    - [Tools](#tools)
    - [Websites](#websites)
  - [Sample problem](#sample-problem)
    - [Problem Statement](#problem-statement)
    - [Solution](#solution)
  - [References](#references)
  - [Conclusion](#conclusion)

## How to identify

To identify Error-Based SQL Injection vulnerabilities, look for web applications that display detailed database error messages. Typical indicators include:

1. **Error Messages:** Inputting certain characters (like single quotes) or SQL keywords (like `SELECT`) results in database error messages being displayed on the web page.
2. **Behavior Testing:** Entering SQL syntax that causes deliberate errors to see if the application leaks information through error messages.
3. **Code Analysis:** Examining the backend code to see if error messages are properly handled or exposed to users.

Example:
```plaintext
http://example.com/product.php?id=1'
```
If this input produces an error message revealing database details, the site may be vulnerable to this attack.

## Code/tools/websites

### Code Snippets
Here is an example of a vulnerable PHP code snippet:
```php
<?php
$id = $_GET['id'];
$query = "SELECT * FROM products WHERE id = '$id'";
$result = mysqli_query($conn, $query);
if (!$result) {
    die("Database error: " . mysqli_error($conn));
}
?>
```

### Tools
- **SQLMap:** An automated tool for SQL injection and database takeover.
- **Burp Suite:** A web vulnerability scanner with tools for manual testing.
- **Havij:** An automated SQL injection tool.

### Websites
> https://www.hackthebox.com/: Great place to learn and practice problems
>
> https://picoctf.com/: They have many labs and past question which you can try with great write-ups available online.

## Sample problem

### Problem Statement
Say you are given access to a web application with a product details page. The URL for the product details page is:
```plaintext
http://example.com/product.php?id=1
```
Identify if the application is vulnerable to Error-Based SQL Injection and extract the version of the database.

### Solution
1. Test for SQL injection vulnerability:
   ```plaintext
   http://example.com/product.php?id=1'
   ```
   If this input produces an error message, it indicates the application might be vulnerable.

2. We can then use error-based payload to extract information:
   ```SQL
   http://example.com/product.php?id=1' AND 1=CONVERT(int, @@version) --
   ```
   This payload attempts to convert the database version string to an integer, causing an error that reveals the version of the database.

3. Analyze the error message:
   The database error message should reveal the version of the database, such as:
   ```plaintext
   Conversion failed when converting the varchar value 'Microsoft SQL Server 2019' to data type int.
   ```

## References

- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security/sql-injection)
- [SQLMap Documentation](https://sqlmap.org/)

## Conclusion

Error-Based SQL Injection leverages detailed error messages from the database to gather information about its structure and contents. Identifying and exploiting these vulnerabilities requires understanding the behavior of SQL queries and error handling mechanisms. By practicing with tools and exercises, you can improve your skills in detecting these vulnerabilities.